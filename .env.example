# Root shared env (single source of truth).
# Semua mode (local dev, local production, Cloudflare) membaca key yang sama.
#
# Cara pakai:
# 1) cp .env.example .env
# 2) isi nilai sensitif/real
# 3) generate env file:
#    - npm run env:local
#    - npm run env:production
# 4) deploy cloud jika perlu:
#    - npm run migrate:remote
#    - npm run deploy:worker
#
# Wajib diisi minimal:
# - BACKEND_DB_*
# - BACKEND_JWT_SECRET, BACKEND_HMAC_GLOBAL_FALLBACK_SECRET
# - BACKEND_MQTT_WS_URL, BACKEND_MQTT_USERNAME, BACKEND_MQTT_PASSWORD

############################
# Backend (shared)
############################
BACKEND_PORT=8787
# Default false untuk dev 2-port; set true untuk production 1-port.
BACKEND_SERVE_DASHBOARD=false
BACKEND_FRONTEND_DIST_DIR=../dashboard/dist
BACKEND_SCHEDULER_ENABLED=true
BACKEND_SCHEDULER_INTERVAL_MS=60000

BACKEND_DB_HOST=127.0.0.1
BACKEND_DB_PORT=3306
BACKEND_DB_USER=root
BACKEND_DB_PASSWORD=
BACKEND_DB_NAME=smartlamp_local
BACKEND_DB_CONNECTION_LIMIT=10

BACKEND_JWT_SECRET=replace-with-strong-secret
BACKEND_HMAC_GLOBAL_FALLBACK_SECRET=replace-with-hmac-secret

BACKEND_MQTT_WS_URL=wss://your-cluster.s1.eu.hivemq.cloud:8884/mqtt
BACKEND_MQTT_USERNAME=replace-with-username
BACKEND_MQTT_PASSWORD=replace-with-password
BACKEND_MQTT_CLIENT_ID_PREFIX=smartlamp-worker

BACKEND_JWT_ACCESS_TTL_SEC=900
BACKEND_JWT_REFRESH_TTL_SEC=2592000
BACKEND_COOKIE_SECURE=false
BACKEND_COOKIE_SAME_SITE=Strict
BACKEND_COOKIE_DOMAIN=
BACKEND_CORS_ORIGINS=http://127.0.0.1:5173,http://localhost:5173

BACKEND_AUTH_LOGIN_RATE_LIMIT_MAX=8
BACKEND_AUTH_LOGIN_RATE_LIMIT_WINDOW_SEC=60
BACKEND_COMMAND_SIGN_RATE_LIMIT_MAX=30
BACKEND_COMMAND_SIGN_RATE_LIMIT_WINDOW_SEC=60

BACKEND_SEED_ADMIN_EMAIL=admin@example.com
BACKEND_SEED_ADMIN_PASSWORD=admin12345
BACKEND_SEED_SAMPLE_DEVICE_ID=lampu-ruang-tamu
BACKEND_SEED_SAMPLE_DEVICE_NAME=Lampu Ruang Tamu
BACKEND_SEED_SAMPLE_DEVICE_LOCATION=Ruang Tamu
BACKEND_SEED_SAMPLE_DEVICE_HMAC_SECRET=replace-with-device-hmac-secret
BACKEND_SEED_DEMO_API_KEY=replace-with-demo-api-key

############################
# Frontend (shared)
############################
# Kosongkan untuk same-origin (mode backend serve dashboard).
# Untuk Cloudflare single-Worker deploy, biarkan kosong agar frontend call API same-origin.
FRONTEND_VITE_API_BASE_URL=

############################
# Cloudflare deploy options
############################
CF_D1_DATABASE_NAME=smartlamp_db
CF_WORKER_ENV=
CF_WORKER_KEEP_VARS=true
CF_WORKER_SYNC_SECRETS=true
CF_WORKER_DRY_RUN=false
# Optional: override struktur backend/wrangler.toml saat migrate/deploy cloud.
# Biarkan kosong jika ingin pakai nilai dari backend/wrangler.toml apa adanya.
# Contoh pengisian:
CF_WORKER_NAME=smartlamp-backend
CF_WORKER_COMPATIBILITY_DATE=2026-02-16
CF_ASSETS_DIRECTORY=../dashboard/dist
CF_ASSETS_BINDING=ASSETS
CF_D1_DATABASE_BINDING=DB
CF_D1_DATABASE_ID=33b4c993-4ebf-471e-aa4d-ca7fb9507ea8
CF_WORKER_CRONS=* * * * *,0 7 * * *
