name = "smartlamp-backend"
main = "src/index.ts"
compatibility_date = "2026-02-16"
compatibility_flags = ["nodejs_compat"]

[assets]
directory = "../dashboard/dist"
binding = "ASSETS"

# Aman dicommit: hanya non-secret defaults.
# Jangan taruh credential/token/password di file ini.
# Secret harus diset via `wrangler secret put` (dibantu script deploy-worker.sh).
# Default vars di sini diselaraskan dengan root `.env.example`.
# Untuk domain production cloud, override via root `.env` + `npm run deploy:worker`.
[vars]
COOKIE_SECURE = "false"
COOKIE_SAME_SITE = "Strict"
COOKIE_DOMAIN = ""
CORS_ORIGINS = "http://127.0.0.1:5173,http://localhost:5173"
MQTT_CLIENT_ID_PREFIX = "smartlamp-worker"
JWT_ACCESS_TTL_SEC = "900"
JWT_REFRESH_TTL_SEC = "2592000"
AUTH_LOGIN_RATE_LIMIT_MAX = "8"
AUTH_LOGIN_RATE_LIMIT_WINDOW_SEC = "60"
COMMAND_EXECUTE_RATE_LIMIT_MAX = "30"
COMMAND_EXECUTE_RATE_LIMIT_WINDOW_SEC = "60"
SEED_ADMIN_EMAIL = "admin@example.com"
SEED_SAMPLE_DEVICE_ID = "lampu-ruang-tamu"

[[d1_databases]]
binding = "DB"
database_name = "smartlamp_db"
database_id = "33b4c993-4ebf-471e-aa4d-ca7fb9507ea8"

[triggers]
crons = ["* * * * *"]
